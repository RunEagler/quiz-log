# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Quiz Log is a quiz creation and learning management application. Users can create quizzes with multiple question types (multiple choice, true/false, short answer), take quizzes, and track their learning progress with statistics.

## Tech Stack

**Backend:**
- Go 1.21+ with gqlgen (GraphQL server)
- PostgreSQL database
- GraphQL schema at `backend/graph/schema/schema.graphqls`

**Frontend:**
- React 18 + TypeScript
- Relay (GraphQL client) with React Router
- Vite as build tool

## Development Commands

### Backend (run from `backend/` directory)

```bash
# Install dependencies and gqlgen
make install

# Generate GraphQL resolvers and types from schema
make generate

# Run development server (http://localhost:8080)
make run

# Database migrations (using sql-migrate)
make migrate-status  # Check migration status
make migrate-up      # Apply migrations
make migrate-down    # Rollback last migration
make migrate-new     # Create new migration file
```

### Frontend (run from `frontend/` directory)

```bash
# Install dependencies
npm install

# Generate Relay types from GraphQL schema
npm run relay

# Run development server (http://localhost:5173)
npm run dev

# Build for production
npm run build
```

## Architecture

### GraphQL-Centric Communication

The entire application communicates through GraphQL. The schema in `backend/graph/schema/schema.graphqls` is the single source of truth for the API contract.

**Code generation workflow:**
1. Edit `backend/graph/schema/schema.graphqls`
2. Run `make generate` in backend → generates Go resolver interfaces and models
3. Run `npm run relay` in frontend → generates TypeScript types for Relay queries/mutations

### Backend Structure

- `server.go` - Main entry point, sets up HTTP server with GraphQL handler at `/query` and playground at `/`
- `db/db.go` - PostgreSQL connection logic using lib/pq
- `db/migrations/` - SQL migration files
- `graph/resolvers/resolver.go` - Root resolver with DB connection
- `graph/resolvers/` - Resolver implementations organized by domain:
  - `quiz.go` - Quiz CRUD operations
  - `question.go` - Question CRUD and import/export
  - `tag.go` - Tag management
  - `attempt.go` - Quiz attempts and answer tracking
  - `statistics.go` - Statistics queries
  - `schema.go` - Generated resolver interfaces (auto-generated by gqlgen)
- `graph/model/models_gen.go` - Generated GraphQL models
- `graph/generated.go` - Generated GraphQL execution code

The Resolver struct holds a `*sql.DB` connection that's injected at server startup and used across all GraphQL resolvers. Resolvers are organized in separate files by domain for better maintainability.

### Frontend Structure

- `src/RelayEnvironment.ts` - Relay environment configured to hit `/query` endpoint
- `src/components/` - React components using Relay hooks (useFragment, useLazyLoadQuery, useMutation)
- Relay compiler reads schema from `../backend/graph/schema/schema.graphqls` (configured in `relay.config.js`)

### Database

PostgreSQL database named `quizlog`. Connection configuration via environment variables:
- `DB_HOST` (default: localhost)
- `DB_USER` (default: postgres)
- `DB_PASSWORD` (default: postgres)
- `DB_NAME` (default: quizlog)

Migrations managed by sql-migrate:
- Configuration: `backend/dbconfig.yml`
- Migration files: `backend/db/migrations/` (must follow `-- +migrate Up` / `-- +migrate Down` format)
- Tracking table: `migrations` in the database

## GraphQL Schema Changes

When modifying the GraphQL schema:

1. Update `backend/graph/schema/schema.graphqls`
2. Regenerate backend code: `cd backend && make generate`
3. Implement/update resolvers in `graph/resolvers/*.go` files (organized by domain)
4. Regenerate frontend types: `cd frontend && npm run relay`
5. Update React components using the changed queries/mutations

**Resolver Organization:**
- New Query/Mutation fields are added as stubs in `graph/resolvers/schema.go`
- Move implementations to appropriate domain files (quiz.go, question.go, etc.)
- gqlgen's `follow-schema` layout keeps resolver code organized and maintainable

## Key GraphQL Features

- **Quiz Management:** CRUD operations for quizzes with tags and questions
- **Question Types:** `MULTIPLE_CHOICE`, `TRUE_FALSE`, `SHORT_ANSWER`
- **Difficulty Levels:** `EASY`, `MEDIUM`, `HARD`
- **Attempt Tracking:** Submit quiz attempts and get scored results
- **Statistics:** Global stats, category-based stats, wrong questions review
- **Import/Export:** JSON-based question import/export

## Environment Setup

Backend requires `.env` file (use `backend/.env.example` as template) for database credentials.

Frontend proxies GraphQL requests to backend in development - ensure backend is running on port 8080 when developing frontend.
